<div class="payment-modal">
  <div class="modal-header">
    <h2 mat-dialog-title>Price Summary</h2>
    <button mat-icon-button (click)="close()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <div class="modal-content-wrapper">
      <!-- Left Column: Price Summary -->
      <div class="price-summary-section">
        <div class="price-detail-row">
          <span class="label">Book Amount</span>
          <span class="value">₹{{ data.baseAmount | number:'1.2-2' }}</span>
        </div>
        <div class="price-detail-row">
          <span class="label">Subtotal</span>
          <span class="value">₹{{ data.baseAmount | number:'1.2-2' }}</span>
        </div>
        <div class="price-detail-row">
          <span class="label">GST (18%)</span>
          <span class="value">₹{{ data.gst | number:'1.2-2' }}</span>
        </div>
        <div class="total-amount-row">
          <span class="label">Total Amount</span>
          <span class="value">₹{{ data.totalAmount | number:'1.2-2' }}</span>
        </div>
      </div>

      <!-- Right Column: Payment Form -->
      <div class="payment-section">
        <h2 class="payment-title">PAYMENT</h2>

        <!-- Payment Method Tabs -->
        <div class="payment-tabs">
          <button 
            class="tab-button" 
            [class.active]="paymentMethod === 'card'"
            (click)="paymentMethod = 'card'">
            Card Payment
          </button>
          <button 
            class="tab-button" 
            [class.active]="paymentMethod === 'upi'"
            (click)="paymentMethod = 'upi'">
            UPI Payment
          </button>
          <button 
            class="tab-button" 
            [class.active]="paymentMethod === 'netbanking'"
            (click)="paymentMethod = 'netbanking'">
            Net Banking
          </button>
        </div>

        <!-- Card Payment Form -->
        <form *ngIf="paymentMethod === 'card'" [formGroup]="cardPaymentForm" class="card-form">
          <div class="form-field">
            <label class="field-label">Card Number</label>
            <input 
              type="text" 
              formControlName="cardNumber" 
              placeholder="1234 5678 9012 3456" 
              maxlength="16"
              class="form-input">
            <div class="error-message" *ngIf="cardPaymentForm.get('cardNumber')?.touched && cardPaymentForm.get('cardNumber')?.hasError('required')">
              Card number is required
            </div>
            <div class="error-message" *ngIf="cardPaymentForm.get('cardNumber')?.touched && cardPaymentForm.get('cardNumber')?.hasError('pattern')">
              Enter 16 digits
            </div>
          </div>

          <div class="form-field">
            <label class="field-label">Cardholder Name</label>
            <input 
              type="text" 
              formControlName="cardName" 
              placeholder="John Doe"
              class="form-input">
            <div class="error-message" *ngIf="cardPaymentForm.get('cardName')?.touched && cardPaymentForm.get('cardName')?.hasError('required')">
              Name is required
            </div>
          </div>

          <div class="form-row">
            <div class="form-field half-width">
              <label class="field-label">Expiry Date</label>
              <input 
                type="text" 
                formControlName="expiryDate" 
                placeholder="MM/YY" 
                maxlength="5"
                class="form-input">
              <div class="error-message" *ngIf="cardPaymentForm.get('expiryDate')?.touched && cardPaymentForm.get('expiryDate')?.hasError('required')">
                Required
              </div>
              <div class="error-message" *ngIf="cardPaymentForm.get('expiryDate')?.touched && cardPaymentForm.get('expiryDate')?.hasError('pattern')">
                Use MM/YY format
              </div>
            </div>

            <div class="form-field half-width">
              <label class="field-label">CVV</label>
              <input 
                type="text" 
                formControlName="cvv" 
                placeholder="123" 
                maxlength="3"
                class="form-input">
              <div class="error-message" *ngIf="cardPaymentForm.get('cvv')?.touched && cardPaymentForm.get('cvv')?.hasError('required')">
                Required
              </div>
              <div class="error-message" *ngIf="cardPaymentForm.get('cvv')?.touched && cardPaymentForm.get('cvv')?.hasError('pattern')">
                3 digits required
              </div>
            </div>
          </div>

          <div class="security-message">
            <mat-icon class="lock-icon">lock</mat-icon>
            <span>Your card details are encrypted and secure</span>
          </div>

          <button 
            type="button"
            class="pay-button" 
            (click)="processPayment()"
            [disabled]="processing">
            <span *ngIf="!processing">Pay ₹{{ data.totalAmount | number:'1.2-2' }}</span>
            <span *ngIf="processing">Processing...</span>
          </button>
        </form>

        <!-- UPI Payment -->
        <div *ngIf="paymentMethod === 'upi'" class="upi-form">
          <div class="form-field">
            <label class="field-label">UPI ID</label>
            <input 
              type="text" 
              [(ngModel)]="upiId" 
              placeholder="username@upi"
              class="form-input">
          </div>
          <p class="hint-text">Enter your UPI ID to complete the payment</p>

          <button 
            type="button"
            class="pay-button" 
            (click)="processPayment()"
            [disabled]="processing">
            <span *ngIf="!processing">Pay ₹{{ data.totalAmount | number:'1.2-2' }}</span>
            <span *ngIf="processing">Processing...</span>
          </button>
        </div>

        <!-- Net Banking -->
        <div *ngIf="paymentMethod === 'netbanking'" class="netbanking-form">
          <div class="info-box">
            <mat-icon>info</mat-icon>
            <p>You will be redirected to your bank's website to complete the payment securely.</p>
          </div>

          <button 
            type="button"
            class="pay-button" 
            (click)="processPayment()"
            [disabled]="processing">
            <span *ngIf="!processing">Pay ₹{{ data.totalAmount | number:'1.2-2' }}</span>
            <span *ngIf="processing">Processing...</span>
          </button>
        </div>
      </div>
    </div>
  </mat-dialog-content>
</div>
