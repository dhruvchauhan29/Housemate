<div class="select-address-container">
  <div class="header">
    <h2>Select Address</h2>
    <p>Choose a saved address or add a new one</p>
  </div>

  <!-- Image placeholder: Address illustration from Figma -->

  <!-- Saved Addresses List -->
  <div class="saved-addresses" *ngIf="(addresses$ | async)?.length">
    <h3>Saved Addresses</h3>
    <div class="address-grid">
      <mat-card 
        *ngFor="let address of addresses$ | async"
        class="address-card"
        [class.selected]="(selectedAddress$ | async)?.id === address.id"
        (click)="selectAddressCard(address)">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>{{ address.label === 'Home' ? 'home' : address.label === 'Office' ? 'work' : 'location_on' }}</mat-icon>
            {{ address.label }}
          </mat-card-title>
          <mat-icon class="check-icon" *ngIf="(selectedAddress$ | async)?.id === address.id">check_circle</mat-icon>
        </mat-card-header>
        <mat-card-content>
          <div class="address-details">
            <p class="address-text">{{ address.serviceAddress }}</p>
            <p class="address-location">{{ address.city }}, {{ address.state }} - {{ address.pinCode }}</p>
            <p class="address-type">{{ address.houseType }}</p>
            <div class="contact-info">
              <p><mat-icon>person</mat-icon> {{ address.contactName }}</p>
              <p><mat-icon>phone</mat-icon> {{ address.contactNumber }}</p>
              <p *ngIf="address.alternateContactNumber">
                <mat-icon>phone</mat-icon> {{ address.alternateContactNumber }}
              </p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Add New Address Button -->
  <div class="add-address-section">
    <button 
      mat-raised-button 
      color="accent" 
      (click)="toggleAddNewForm()"
      class="add-address-btn">
      <mat-icon>{{ showAddNewForm ? 'close' : 'add' }}</mat-icon>
      {{ showAddNewForm ? 'Cancel' : 'Add New Address' }}
    </button>
  </div>

  <!-- Add Address Form -->
  <mat-card *ngIf="showAddNewForm" class="address-form-card">
    <mat-card-header>
      <mat-card-title>Add New Address</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="addressForm" class="address-form">
        <mat-form-field appearance="outline">
          <mat-label>Service Address</mat-label>
          <input matInput formControlName="serviceAddress" placeholder="Enter complete address">
          <mat-icon matPrefix>location_on</mat-icon>
          <mat-error *ngIf="addressForm.get('serviceAddress')?.hasError('required')">
            Address is required
          </mat-error>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" placeholder="Enter city">
            <mat-error *ngIf="addressForm.get('city')?.hasError('required')">
              City is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>State</mat-label>
            <input matInput formControlName="state" placeholder="Enter state">
            <mat-error *ngIf="addressForm.get('state')?.hasError('required')">
              State is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Pin Code</mat-label>
            <input matInput formControlName="pinCode" placeholder="6-digit PIN code" maxlength="6">
            <mat-error *ngIf="addressForm.get('pinCode')?.hasError('required')">
              PIN code is required
            </mat-error>
            <mat-error *ngIf="addressForm.get('pinCode')?.hasError('pattern')">
              PIN code must be 6 digits
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>House Type</mat-label>
            <mat-select formControlName="houseType" placeholder="Select house type">
              <mat-option *ngFor="let type of houseTypeOptions" [value]="type">
                {{ type }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="addressForm.get('houseType')?.hasError('required')">
              House type is required
            </mat-error>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Contact Name</mat-label>
          <input matInput formControlName="contactName" placeholder="Enter contact name">
          <mat-icon matPrefix>person</mat-icon>
          <mat-error *ngIf="addressForm.get('contactName')?.hasError('required')">
            Contact name is required
          </mat-error>
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Contact Number</mat-label>
            <input matInput formControlName="contactNumber" placeholder="10-digit mobile number" maxlength="10">
            <mat-icon matPrefix>phone</mat-icon>
            <mat-error *ngIf="addressForm.get('contactNumber')?.hasError('required')">
              Contact number is required
            </mat-error>
            <mat-error *ngIf="addressForm.get('contactNumber')?.hasError('pattern')">
              Contact number must be 10 digits
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Alternate Contact Number</mat-label>
            <input matInput formControlName="alternateContactNumber" placeholder="10-digit mobile number (optional)" maxlength="10">
            <mat-icon matPrefix>phone</mat-icon>
            <mat-error *ngIf="addressForm.get('alternateContactNumber')?.hasError('pattern')">
              Alternate number must be 10 digits
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button 
            mat-raised-button 
            color="primary" 
            type="button"
            (click)="saveAddress()"
            [disabled]="addressForm.invalid">
            <mat-icon>save</mat-icon>
            Save Address
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Navigation Buttons -->
  <div class="navigation-actions">
    <button mat-raised-button (click)="previousStep()" class="btn-back">
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
    <button 
      mat-raised-button 
      color="primary" 
      (click)="nextStep()" 
      [disabled]="!(selectedAddress$ | async)"
      class="btn-next">
      Next
      <mat-icon>arrow_forward</mat-icon>
    </button>
  </div>
</div>
