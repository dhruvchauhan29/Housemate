<div class="select-address-container">
  <!-- Collapsed Select Service Section -->
  <div class="collapsed-section">
    <div class="collapsed-header">
      <h3 class="collapsed-title">Select Service</h3>
    </div>
    <mat-icon class="check-icon">check_circle</mat-icon>
  </div>

  <!-- Collapsed Select Date & Time Section -->
  <div class="collapsed-section">
    <div class="collapsed-header">
      <h3 class="collapsed-title">Select Date & Time</h3>
    </div>
    <mat-icon class="check-icon">check_circle</mat-icon>
  </div>

  <!-- Address Details Section -->
  <div class="address-section">
    <h2 class="section-title">Address Details</h2>
    
    <!-- Saved Addresses List -->
    <div class="saved-addresses" *ngIf="!showAddNewForm && (addresses$ | async)?.length">
      <div class="address-grid">
        <div 
          *ngFor="let address of addresses$ | async"
          class="address-card"
          [class.selected]="(selectedAddress$ | async)?.id === address.id"
          (click)="selectAddressCard(address)">
          <div class="address-header">
            <div class="address-icon">
              <!-- Image placeholder: Red location pin icon from Figma -->
              <mat-icon>location_on</mat-icon>
            </div>
            <div class="address-header-text">
              <div class="address-label">
                {{ address.label }}
                <span class="address-distance">{{ address.houseType }}</span>
              </div>
            </div>
          </div>
          <div class="address-content">
            <p class="address-text">{{ address.serviceAddress }}</p>
            <p class="address-location">{{ address.city }}, {{ address.state }} - {{ address.pinCode }} â€¢ +91 {{ address.contactNumber }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Add New Address Button -->
    <div class="add-address-section" *ngIf="!showAddNewForm">
      <button 
        mat-button
        (click)="toggleAddNewForm()"
        class="add-address-btn">
        <mat-icon>add</mat-icon>
        Add New Address
      </button>
    </div>

    <!-- Add Address Form -->
    <div *ngIf="showAddNewForm" class="address-form-container">
      <div class="form-header">
        <button 
          mat-raised-button 
          color="primary" 
          type="button"
          (click)="saveAddress()"
          [disabled]="addressForm.invalid"
          class="save-address-btn">
          Save New Address
        </button>
      </div>
      
      <form [formGroup]="addressForm" class="address-form">
        <div class="form-field-wrapper">
          <label class="field-label">
            <mat-icon>location_on</mat-icon>
            Service Address <span class="required">*</span>
          </label>
          <input 
            class="form-input"
            formControlName="serviceAddress" 
            placeholder="Enter your complete address (House/Flat no., Building, Street, Landmark)">
          <div class="field-error" *ngIf="addressForm.get('serviceAddress')?.touched && addressForm.get('serviceAddress')?.hasError('required')">
            Address is required
          </div>
        </div>

        <div class="form-row-three">
          <div class="form-field-wrapper">
            <label class="field-label">
              City <span class="required">*</span>
            </label>
            <input 
              class="form-input"
              formControlName="city" 
              placeholder="e.g. Mumbai">
            <div class="field-error" *ngIf="addressForm.get('city')?.touched && addressForm.get('city')?.hasError('required')">
              City is required
            </div>
          </div>

          <div class="form-field-wrapper">
            <label class="field-label">
              State <span class="required">*</span>
            </label>
            <input 
              class="form-input"
              formControlName="state" 
              placeholder="e.g. Maharashtra">
            <div class="field-error" *ngIf="addressForm.get('state')?.touched && addressForm.get('state')?.hasError('required')">
              State is required
            </div>
          </div>

          <div class="form-field-wrapper">
            <label class="field-label">
              PIN Code <span class="required">*</span>
            </label>
            <input 
              class="form-input"
              formControlName="pinCode" 
              placeholder="400001" 
              maxlength="6">
            <div class="field-error" *ngIf="addressForm.get('pinCode')?.touched && addressForm.get('pinCode')?.hasError('required')">
              PIN code is required
            </div>
            <div class="field-error" *ngIf="addressForm.get('pinCode')?.touched && addressForm.get('pinCode')?.hasError('pattern')">
              PIN code must be 6 digits
            </div>
          </div>
        </div>

        <div class="form-row-two">
          <div class="form-field-wrapper">
            <label class="field-label">
              Contact Name <span class="required">*</span>
            </label>
            <input 
              class="form-input"
              formControlName="contactName" 
              placeholder="Your full name">
            <div class="field-error" *ngIf="addressForm.get('contactName')?.touched && addressForm.get('contactName')?.hasError('required')">
              Contact name is required
            </div>
          </div>

          <div class="form-field-wrapper">
            <label class="field-label">
              Contact Number <span class="required">*</span>
            </label>
            <div class="phone-input-wrapper">
              <span class="phone-prefix">+91</span>
              <input 
                class="form-input phone-input"
                formControlName="contactNumber" 
                placeholder="9876543210" 
                maxlength="10">
            </div>
            <div class="field-error" *ngIf="addressForm.get('contactNumber')?.touched && addressForm.get('contactNumber')?.hasError('required')">
              Contact number is required
            </div>
            <div class="field-error" *ngIf="addressForm.get('contactNumber')?.touched && addressForm.get('contactNumber')?.hasError('pattern')">
              Contact number must be 10 digits
            </div>
          </div>
        </div>

        <div class="form-field-wrapper">
          <label class="field-label">
            Alternate Contact Number (Optional)
          </label>
          <div class="phone-input-wrapper">
            <span class="phone-prefix">+91</span>
            <input 
              class="form-input phone-input"
              formControlName="alternateContactNumber" 
              placeholder="9876543210" 
              maxlength="10">
          </div>
          <div class="field-error" *ngIf="addressForm.get('alternateContactNumber')?.touched && addressForm.get('alternateContactNumber')?.hasError('pattern')">
            Alternate number must be 10 digits
          </div>
        </div>

        <div class="form-field-wrapper">
          <label class="field-label">
            <mat-icon>home</mat-icon>
            House Type
          </label>
          <div class="house-type-buttons">
            <button 
              *ngFor="let type of houseTypeOptions"
              type="button"
              class="house-type-btn"
              [class.selected]="addressForm.get('houseType')?.value === type"
              (click)="selectHouseType(type)">
              {{ type }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
