<div class="registration-page">
  <header class="header">
    <div class="logo" (click)="navigateToHome()">
      <div class="logo-icon">H</div>
      <span class="logo-text">HouseMate</span>
    </div>
    <div class="header-links">
      <a (click)="navigateToCustomerLogin()" class="header-link">Customer Login</a>
      <a (click)="navigateToExpertLogin()" class="header-link">Expert Login</a>
    </div>
  </header>

  <div class="registration-container">
    <div class="registration-content">
      <!-- Left Side: Step Indicator -->
      <div class="step-sidebar">
        <div class="step-item" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
          <div class="step-circle">
            <span *ngIf="currentStep <= 1">1</span>
            <span *ngIf="currentStep > 1">‚úì</span>
          </div>
          <span class="step-text">Personal<br>Information</span>
        </div>

        <div class="step-connector" [class.completed]="currentStep > 1"></div>

        <div class="step-item" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
          <div class="step-circle">
            <span *ngIf="currentStep <= 2">2</span>
            <span *ngIf="currentStep > 2">‚úì</span>
          </div>
          <span class="step-text">Service<br>Profile</span>
        </div>

        <div class="step-connector" [class.completed]="currentStep > 2"></div>

        <div class="step-item" [class.active]="currentStep === 3">
          <div class="step-circle">
            <span>3</span>
          </div>
          <span class="step-text">ID<br>Verification</span>
        </div>
      </div>

      <!-- Right Side: Form -->
      <div class="registration-form-section">
        <div class="form-header">
          <h3 class="subtitle">New User?</h3>
          <h1 class="title">REGISTER NOW!</h1>
          <p class="description">
            To connect with verified, trained home-service experts for ASAP or scheduled services. Fast, transparent, and reliable.
          </p>
        </div>

        <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
          <!-- Step 1: Personal Information -->
          <div class="step-content" *ngIf="currentStep === 1">
            <div class="info-banner">
              <span class="info-icon">‚ÑπÔ∏è</span>
              <span class="info-text">Ensure all information matches your identity documents for smooth verification.</span>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">üë§</span>
                Full Name <span class="required">*</span>
              </label>
              <input 
                type="text" 
                class="form-control" 
                formControlName="fullName"
                placeholder="Enter your full name as per ID"
                [class.invalid]="registrationForm.get('fullName')?.invalid && registrationForm.get('fullName')?.touched"
              />
              <div class="error-message" *ngIf="registrationForm.get('fullName')?.invalid && registrationForm.get('fullName')?.touched">
                Full name is required
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">
                  <span class="label-icon">üì±</span>
                  Mobile Number <span class="required">*</span>
                </label>
                <div class="mobile-input">
                  <span class="country-code">+91</span>
                  <input 
                    type="tel" 
                    class="form-control mobile-field" 
                    formControlName="mobileNumber"
                    placeholder="9876543210"
                    maxlength="10"
                    [class.invalid]="registrationForm.get('mobileNumber')?.invalid && registrationForm.get('mobileNumber')?.touched"
                  />
                </div>
                <div class="error-message" *ngIf="registrationForm.get('mobileNumber')?.invalid && registrationForm.get('mobileNumber')?.touched">
                  Please enter a valid 10-digit mobile number
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <span class="label-icon">‚úâÔ∏è</span>
                  Email <span class="required">*</span>
                </label>
                <input 
                  type="email" 
                  class="form-control" 
                  formControlName="email"
                  placeholder="expert@example.com"
                  [class.invalid]="registrationForm.get('email')?.invalid && registrationForm.get('email')?.touched"
                />
                <div class="error-message" *ngIf="registrationForm.get('email')?.invalid && registrationForm.get('email')?.touched">
                  Please enter a valid email address
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">
                    <span class="label-icon">üîí</span>
                    Password <span class="required">*</span>
                  </label>
                  <input 
                    type="password" 
                    class="form-control" 
                    formControlName="password"
                    placeholder="Min. 6 characters"
                    [class.invalid]="registrationForm.get('password')?.invalid && registrationForm.get('password')?.touched"
                  />
                  <div class="error-message" *ngIf="registrationForm.get('password')?.invalid && registrationForm.get('password')?.touched">
                    Password must be at least 6 characters
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">
                    <span class="label-icon">üîí</span>
                    Confirm Password <span class="required">*</span>
                  </label>
                  <input 
                    type="password" 
                    class="form-control" 
                    formControlName="confirmPassword"
                    placeholder="Re-enter password"
                    [class.invalid]="registrationForm.get('confirmPassword')?.invalid && registrationForm.get('confirmPassword')?.touched"
                  />
                  <div class="error-message" *ngIf="registrationForm.get('confirmPassword')?.hasError('mismatch')">
                    Passwords do not match
                  </div>
                  <div class="error-message" *ngIf="registrationForm.get('confirmPassword')?.hasError('required') && registrationForm.get('confirmPassword')?.touched">
                    Please confirm your password
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <span class="label-icon">üìÖ</span>
                  Date of Birth <span class="required">*</span>
                </label>
                <input 
                  type="date" 
                  class="form-control" 
                  formControlName="dateOfBirth"
                  [class.invalid]="registrationForm.get('dateOfBirth')?.invalid && registrationForm.get('dateOfBirth')?.touched"
                />
                <div class="error-message" *ngIf="registrationForm.get('dateOfBirth')?.invalid && registrationForm.get('dateOfBirth')?.touched">
                  Date of birth is required
                </div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">üìç</span>
                Complete Address <span class="required">*</span>
              </label>
              <input 
                type="text" 
                class="form-control" 
                formControlName="completeAddress"
                placeholder="House/Flat No., Building Name, Street, Landmark"
                [class.invalid]="registrationForm.get('completeAddress')?.invalid && registrationForm.get('completeAddress')?.touched"
              />
              <div class="error-message" *ngIf="registrationForm.get('completeAddress')?.invalid && registrationForm.get('completeAddress')?.touched">
                Complete address is required
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">
                  City <span class="required">*</span>
                </label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="city"
                  placeholder="e.g., Mumbai"
                  [class.invalid]="registrationForm.get('city')?.invalid && registrationForm.get('city')?.touched"
                />
                <div class="error-message" *ngIf="registrationForm.get('city')?.invalid && registrationForm.get('city')?.touched">
                  City is required
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">
                  State <span class="required">*</span>
                </label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="state"
                  placeholder="e.g., Maharashtra"
                  [class.invalid]="registrationForm.get('state')?.invalid && registrationForm.get('state')?.touched"
                />
                <div class="error-message" *ngIf="registrationForm.get('state')?.invalid && registrationForm.get('state')?.touched">
                  State is required
                </div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                PIN Code <span class="required">*</span>
              </label>
              <input 
                type="text" 
                class="form-control pin-input" 
                formControlName="pinCode"
                placeholder="400001"
                maxlength="6"
                [class.invalid]="registrationForm.get('pinCode')?.invalid && registrationForm.get('pinCode')?.touched"
              />
              <div class="error-message" *ngIf="registrationForm.get('pinCode')?.invalid && registrationForm.get('pinCode')?.touched">
                Please enter a valid 6-digit PIN code
              </div>
            </div>
          </div>

          <!-- Step 2: Service Profile -->
          <div class="step-content" *ngIf="currentStep === 2">
            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">üíº</span>
                Services You Offer <span class="required">*</span>
              </label>
              <p class="field-hint">Select all services you can provide</p>
              <div class="services-grid">
                <div 
                  *ngFor="let service of services" 
                  class="service-card"
                  [class.selected]="isServiceSelected(service.id)"
                  (click)="toggleService(service.id)"
                >
                  <div class="service-icon">{{ service.icon }}</div>
                  <div class="service-name">{{ service.name }}</div>
                </div>
              </div>
              <div class="error-message" *ngIf="servicesOfferedArray.touched && servicesOfferedArray.length === 0">
                Please select at least one service
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">‚è±Ô∏è</span>
                Total Experience <span class="required">*</span>
              </label>
              <div class="experience-row">
                <div class="experience-field">
                  <label class="field-sublabel">Years</label>
                  <select 
                    class="form-control" 
                    formControlName="experienceYears"
                    [class.invalid]="registrationForm.get('experienceYears')?.invalid && registrationForm.get('experienceYears')?.touched"
                  >
                    <option value="">Select years</option>
                    <option *ngFor="let year of years" [value]="year">{{ year }}</option>
                  </select>
                </div>
                <div class="experience-field">
                  <label class="field-sublabel">Months</label>
                  <select 
                    class="form-control" 
                    formControlName="experienceMonths"
                    [class.invalid]="registrationForm.get('experienceMonths')?.invalid && registrationForm.get('experienceMonths')?.touched"
                  >
                    <option value="">Select months</option>
                    <option *ngFor="let month of months" [value]="month">{{ month }}</option>
                  </select>
                </div>
              </div>
              <div class="error-message" *ngIf="(registrationForm.get('experienceYears')?.invalid || registrationForm.get('experienceMonths')?.invalid) && (registrationForm.get('experienceYears')?.touched || registrationForm.get('experienceMonths')?.touched)">
                Please select your experience
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">‚≠ê</span>
                Specializations
              </label>
              <p class="field-hint">Describe any specific skills or areas where you excel (optional)</p>
              <textarea 
                class="form-control" 
                formControlName="specializations"
                rows="4"
                placeholder="E.g., Expert in deep cleaning, Experienced with traditional Indian cooking, Certified in first aid for elderly care..."
              ></textarea>
            </div>
          </div>

          <!-- Step 3: ID Verification -->
          <div class="step-content" *ngIf="currentStep === 3">
            <div class="privacy-banner">
              <span class="privacy-icon">üîí</span>
              <div class="privacy-text">
                <strong>Data Privacy:</strong>
                <p>Your documents are encrypted and stored securely. We comply with all Indian data protection regulations. Your information will only be used for verification purposes.</p>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                Select ID Proof Type <span class="required">*</span>
              </label>
              <select 
                class="form-control" 
                formControlName="idProofType"
              >
                <option *ngFor="let type of idProofTypes" [value]="type.value">{{ type.label }}</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">
                <span class="label-icon">üÜî</span>
                {{ registrationForm.get('idProofType')?.value === 'aadhar' ? 'Aadhar Card Number' : 
                    registrationForm.get('idProofType')?.value === 'pan' ? 'PAN Card Number' : 
                    'Passport Number' }} <span class="required">*</span>
              </label>
              <input 
                type="text" 
                class="form-control" 
                formControlName="idProofNumber"
                [placeholder]="registrationForm.get('idProofType')?.value === 'aadhar' ? '567212345566' : 'Enter ID number'"
                [maxlength]="registrationForm.get('idProofType')?.value === 'aadhar' ? 12 : 20"
                [class.invalid]="registrationForm.get('idProofNumber')?.invalid && registrationForm.get('idProofNumber')?.touched"
              />
              <div class="error-message" *ngIf="registrationForm.get('idProofNumber')?.invalid && registrationForm.get('idProofNumber')?.touched">
                Please enter a valid {{ registrationForm.get('idProofType')?.value === 'aadhar' ? '12-digit Aadhar number' : 'ID number' }}
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                Upload Recent Photograph <span class="required">*</span>
              </label>
              <div class="upload-area" [class.has-file]="selectedFile">
                <input 
                  type="file" 
                  id="photoUpload"
                  class="file-input" 
                  accept=".jpg,.jpeg,.png"
                  (change)="onFileSelected($event)"
                />
                <label for="photoUpload" class="upload-label">
                  <div *ngIf="!selectedPhotoPreview" class="upload-prompt">
                    <div class="upload-icon">üì§</div>
                    <p class="upload-text">Upload a clear photo of yourself</p>
                    <p class="upload-hint">JPG or PNG (Max 5MB)</p>
                  </div>
                  <div *ngIf="selectedPhotoPreview" class="photo-preview">
                    <img [src]="selectedPhotoPreview" alt="Photo preview" />
                    <p class="file-name">{{ selectedFile?.name }}</p>
                  </div>
                </label>
              </div>
              <p class="field-note">This will be used for face matching with your ID document</p>
              <div class="error-message" *ngIf="registrationForm.get('photograph')?.invalid && registrationForm.get('photograph')?.touched">
                Please upload your photograph
              </div>
            </div>
          </div>

          <div class="error-message global-error" *ngIf="errorMessage">
            {{ errorMessage }}
          </div>

          <!-- Navigation Buttons -->
          <div class="button-group">
            <button 
              type="button" 
              class="btn btn-secondary" 
              (click)="prevStep()" 
              *ngIf="currentStep > 1"
              [disabled]="isSubmitting"
            >
              ‚Üê PREVIOUS
            </button>
            <button 
              type="button" 
              class="btn btn-primary" 
              (click)="nextStep()" 
              *ngIf="currentStep < 3"
            >
              NEXT ‚Üí
            </button>
            <button 
              type="submit" 
              class="btn btn-submit" 
              *ngIf="currentStep === 3" 
              [disabled]="registrationForm.invalid || isSubmitting"
            >
              <span *ngIf="!isSubmitting">Submit ‚Üí</span>
              <span *ngIf="isSubmitting">Submitting...</span>
            </button>
          </div>

          <div class="form-footer">
            <a (click)="navigateToHome()">Back to home</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
