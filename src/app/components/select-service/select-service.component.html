<div class="select-service-container">
  <!-- Service Selection Section -->
  <div class="service-selection-section">
    <h2 class="section-title">Select Service</h2>
    <div class="services-horizontal-scroll">
      <div 
        *ngFor="let service of services" 
        class="service-card"
        [class.selected]="selectedServiceId === service.id"
        (click)="selectServiceCard(service)">
        <!-- TODO: Insert service icon image from Figma -->
        <div class="service-icon-placeholder" [style.background]="'#000'">
          <img src="" alt="Service icon from Figma design" style="display: none;" />
        </div>
        <h3 class="service-name">{{ service.name }}</h3>
      </div>
    </div>
  </div>

  <!-- Expert Selection Section -->
  <div class="expert-selection-section">
    <div class="expert-header">
      <h2 class="section-title">Available Expert Near You</h2>
      <div class="expert-actions">
        <button mat-icon-button class="filter-button" (click)="toggleFilters()">
          <mat-icon>tune</mat-icon>
        </button>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
      <mat-form-field appearance="outline" class="search-field">
        <mat-icon matPrefix>search</mat-icon>
        <input 
          matInput 
          placeholder="Search by expert name" 
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange($event)"
        >
        <button mat-icon-button matSuffix *ngIf="searchQuery" (click)="searchQuery = ''; onSearchChange('')">
          <mat-icon>clear</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <!-- Filters Section -->
    <div class="filters-section" *ngIf="showFilters">
      <div class="filters-container">
        <div class="filter-row">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Sort By</mat-label>
            <mat-select [(ngModel)]="sortBy" (selectionChange)="applyFilters()">
              <mat-option value="">Default</mat-option>
              <mat-option value="distance">Nearest First</mat-option>
              <mat-option value="rating">Highest Rated</mat-option>
              <mat-option value="price">Lowest Price</mat-option>
              <mat-option value="experience">Most Experienced</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Min Rating</mat-label>
            <mat-select [(ngModel)]="minRating" (selectionChange)="applyFilters()">
              <mat-option [value]="0">Any</mat-option>
              <mat-option [value]="4.0">4.0+</mat-option>
              <mat-option [value]="4.5">4.5+</mat-option>
              <mat-option [value]="4.8">4.8+</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Language</mat-label>
            <mat-select [(ngModel)]="selectedLanguage" (selectionChange)="applyFilters()">
              <mat-option value="">Any</mat-option>
              <mat-option value="Hindi">Hindi</mat-option>
              <mat-option value="English">English</mat-option>
              <mat-option value="Marathi">Marathi</mat-option>
              <mat-option value="Tamil">Tamil</mat-option>
              <mat-option value="Telugu">Telugu</mat-option>
              <mat-option value="Bengali">Bengali</mat-option>
              <mat-option value="Gujarati">Gujarati</mat-option>
              <mat-option value="Malayalam">Malayalam</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="filter-row">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Min Price (₹/hr)</mat-label>
            <input matInput type="number" [(ngModel)]="minPrice" min="0" (change)="applyFilters()">
          </mat-form-field>

          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Max Price (₹/hr)</mat-label>
            <input matInput type="number" [(ngModel)]="maxPrice" min="0" (change)="applyFilters()">
          </mat-form-field>

          <mat-checkbox [(ngModel)]="verifiedOnly" (change)="applyFilters()" class="verified-checkbox">
            Verified Only
          </mat-checkbox>
        </div>

        <div class="filter-actions">
          <button mat-stroked-button (click)="clearFilters()">
            <mat-icon>clear_all</mat-icon>
            Clear Filters
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoadingExperts">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading experts...</p>
    </div>

    <!-- Error State -->
    <div class="error-state" *ngIf="expertError && !isLoadingExperts">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <h3>Oops! Something went wrong</h3>
      <p>{{ expertError }}</p>
      <button mat-raised-button color="primary" (click)="loadExperts()">
        <mat-icon>refresh</mat-icon>
        Retry
      </button>
    </div>

    <!-- Expert Cards Grid -->
    <div class="expert-cards-grid" *ngIf="!isLoadingExperts && !expertError && filteredExperts.length > 0">
      <div 
        *ngFor="let expert of filteredExperts" 
        class="expert-card"
        [class.selected]="selectedExpertId === expert.id"
        (click)="selectExpertCard(expert)">
        <div class="expert-content">
          <div class="expert-left">
            <!-- TODO: Figma image placeholder – keep background black -->
            <div class="expert-image-placeholder" [style.background]="'#000'">
              <img src="" alt="Expert profile image from Figma design" style="display: none;" />
            </div>
          </div>
          
          <div class="expert-right">
            <div class="expert-name-row">
              <h3 class="expert-name">{{ expert.fullName || 'Unknown Expert' }}</h3>
              <mat-icon *ngIf="expert.verified" class="verified-icon">verified</mat-icon>
            </div>

            <div class="expert-rating">
              <mat-icon class="star-icon">star</mat-icon>
              <span class="rating-value">{{ expert.rating || 4.5 }} ({{ expert.reviewsCount || 100 }})</span>
              <mat-icon class="briefcase-icon">work</mat-icon>
              <span class="experience">{{ expert.experience }} experience</span>
            </div>

            <div class="expert-location">
              <mat-icon class="location-icon">location_on</mat-icon>
              <span>{{ expert.address }}</span>
            </div>

            <div class="expert-services">
              <span class="service-badge">{{ expert.serviceCategory }}</span>
            </div>

            <div class="expert-languages">
              <span class="languages-label">Languages:</span>
              <span class="languages-value">{{ expert.languages?.join(', ') || 'Hindi, English' }}</span>
            </div>

            <!-- Note: View Certificates functionality will be implemented in future -->
            <a href="#" class="view-certificates" (click)="$event.preventDefault(); $event.stopPropagation();">
              View Certificates
            </a>
          </div>

          <div class="expert-price">
            <span class="price-value">₹{{ expert.pricePerHour || 100 }}/hr</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoadingExperts && !expertError && filteredExperts.length === 0">
      <mat-icon class="empty-icon">person_search</mat-icon>
      <h3>No Experts Found</h3>
      <p *ngIf="searchQuery">
        No experts match your search criteria. Try adjusting your search.
      </p>
      <p *ngIf="!searchQuery && (minRating > 0 || verifiedOnly || selectedLanguage || minPrice > 0 || maxPrice < 200)">
        No experts match your filter criteria. Try adjusting your filters.
      </p>
      <p *ngIf="!searchQuery && minRating === 0 && !verifiedOnly && !selectedLanguage && minPrice === 0 && maxPrice >= 200">
        No experts are currently available. Please check back later.
      </p>
      <button mat-raised-button color="primary" (click)="clearFilters()" *ngIf="searchQuery || minRating > 0 || verifiedOnly || selectedLanguage || minPrice > 0 || maxPrice < 200">
        <mat-icon>refresh</mat-icon>
        Clear Filters
      </button>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="!isLoadingExperts && !expertError && filteredExperts.length > 0 && totalPages > 1">
      <button mat-icon-button [disabled]="currentPage === 1" (click)="previousPage()">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <span class="page-info">Page {{ currentPage }} of {{ totalPages }} ({{ totalExperts }} experts)</span>
      <button mat-icon-button [disabled]="currentPage === totalPages" (click)="nextPage()">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </div>
</div>
